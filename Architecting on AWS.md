# DAY_1

aws.amazon.com/training : 아마존 교육과정 설명

learn.aws.quicklab

- 이번 과정 수강 후 솔루션스 아키텍트 - 어소시에이트 자격증 취득 가능($150)
  - pearson, pearsonview가 aws certificate 파트너사
- 조재구 강사님
- [소개] Sumerian - amazone 3D/VR 솔루션
- 비용효율적 사용방법론에 대한 소개

- 이거 다음 강좌는 advanced arch 강좌 추천
- 참여 어려우면 digital training 코스 온라인으로 영어로 들을 수 있음
- developer과정도 있음

클라우드란

- 프로그래밍 가능한 리소스 : 제공하는 API통해 리소스를 프로그래밍을 통해 할당 및 사용 가능
- 동적 기능
- 종량 과금제(사용한 만큼 과금)

 aws well-architected framework : 클라우드 컴퓨팅 설계에 대한 비판적 관점

새로운 기술 소개하는 re-invent 행사 매년 있음

작년의 새로운 서비스로 aws well-architected sevice

well-architect tool을 통해 현재 인프라 설계 검토 가능

글로벌 인프라로 데이터 센터(수천개 서버) 운영

모든 데이터 센터는 always power on상태임. 온라인 연결

모든 가용영역에서 재해복구 센터 운영

여러개 데이터 센터묶은 것을 가용영역이라고 함 - 재해 발생 시 한개 가용영역 내 데이트 센터는 다 불용됨

가용영역은 최소 2개로 지리적으로 떨어져 있음. - 리전을 구성하는 것이 가용영역(최소 1개)

가용영역 간은 고속네트웍 연결

가용영역은 최소 2개 유지하고 꼭 다른 가용영역에 복제(이중화)해두어야 함 

따로 재해복구센터 설정 필요 없고 가용영역 이중화가 재해대비임

가용영역의 위치는 공개하지 않음

전세계 21개 리전

리전 간에는 백본 네트워크 연결(인터넷 선이 아닌..)

리전 이외에 엣지 로케이션(리전 외 바깥 시설물에 설치된 것)

일부 서비스(router53, cloud front(cdn) 등)은 엣지로케이션에서 동작

엣지로케이션 사용의 장점 - 리전보다 더 빠름. 더 가까우므로



## Amazon S3

- 객체수준 스토리지(파일시스템과 구분)
- 이벤트 트리거 기능 제공(db내 변경사항을 noti가능)
- 스토리지 url생성되어 공유 가능 - 정적 웹페이지 만들 경우 ec2필요 없이 그냥 s3에 html올려서 호스팅해도 됨
- 데이터를 버킷 단위로 관리 - 버킷 이름이 도메인명과 매핑되기 때문에 고유이름 정해야 함
- 객체 생성 후 publish해야 다른 사용자들 접근 가능
- 버켓 퍼블리쉬 정책을 통해 액세스 제한 가능
- 버켓 정책은 json형식으로 설정 (혹은 policy generator사용해도 됨)
- 정적웹페이지 기능 지원하기 때문에 현재 도메인 아닌 다른 도메인 접근 가능하도록 ___기능 제공
- 업로드 가능한 파일 수 제한 없음
- 멀티파트 업로드 : 대용량 데이터 업로드할 경우 슬라이싱 하여 멀티스레드로 업로드하는 기능 지원 (100MB 이상 데이터 업로드시 사용 권장)
- 버킷 생성 시 리전 선택해야 하는데, 이 때 물리적 거리 고려해야 함
- 원거리 리전 데이터 다운로드 시 TRANSFER ACCELERATION 기능 사용 가능
- 인터넷 통한 데이터 처리이기 때문에 고속 처리 필요하면 S3사용하면 안됨
- 액세스 많거나 데이터 급증하면 빠르지 않음
- 자주바뀌는 데이터나 장기 아카이브 데이터의 경우 부적합
- 월별 GB당 과금
- 전송건에 따른 과금 (리전 내의 이동의 경우 매우 저렴하거나 무료 / 리전 간 이동의 경우 데이터 사이즈 * 사용자 수 에 따른 통신비용)
- 인바운드의 경우 무료  / 아웃바운드 트래픽의 경우 과금
- http api 호출건당 과금 (GET, PUT, POST 등) - 건당 과금이므로 데이터 베이스 한번에 과금 등
- 스토리지 클래스 지정 가능 - 클래스에 따라 사용요금 다르기 때문에 비용 절감 위해 적절한 클래스 선택 중요
  - 클래스 : 데이터 특성에 맞게 클래스 선택
- S3 지능형 계층화 기능 제공 (두개의 스토리지 계층 간 액세스로 객체 자동 이동)
- S3 수명주기 정책 : 생성 후 기간 기준으로 객체 클래스 설정 혹은 삭제 처리 - 추천

### S3 Glacier

  - 아카이브용 스토리지(장기 미사용)
  - 데이터 가져올 때 느림 - audit log 등 : 저장소 잠금 기능 제공하여 변조 방지 증명해야 하는 용도로 사용 가능
  - 

  ### 리전 선택 기준

- 프라이버시 법률
- 과금 (리전별로 비용 다름)
- 속도 **CLOUDPING.INFO : 리전 별 핑테스트 결과 확인 가능(https://www.cloudping.info/)**
- 

버킷 생성(고유 도메인명 할당)

public access 정책 적용해야 함 - 공개 범위

cloud watch - 버킷 내 요청 및 데이터전송 모니터링

쿠버네틱스 도커 -> os 가상화 (ec2같은 하드웨어 가상화와는 구분)

가상화는 zen 기반의 기술이라 라킹 염려하진 않아도 됨? : ZEN은 하이퍼바이저랑 관련. 찾아보기

vm import/export다 가능

AMI(Amazon 머신 이미지: os) 이미지 를 통해 설치

ami(파일 하나)를 ec2에 카피앤페이스트

ebs로 블록드라이브 매핑함

ami 버저닝 가능

user data :  생성 후 ami 부팅 시 1회 사옹하는 스크립트

인스턴스 내부에서 인스턴스 메타데이터(인스턴스 이름, 가용영역, 리전, 퍼블릭 ipv4) 제공하는 url : 169.254.169.254

ec2생성하면 인터넷 통신이 가능한 공인ip(public ip) 생성하여 부여함

ec2에서 ipconfig 커맨드로 공인ip확인불가. 꼭 metadata통해 봐야 함

물리적인 호스트 디스크 사용 : 인스턴스 스토리지 (무료, 빠른 속도, 휘발성-인스턴스 파워오프할 경우 다 날아감, 인스턴스 타입에 따라 ssd 용량 정해져있음)

네트워크 통해 ebs 연결하여 사용 : 블록레벨 스토리지

IOPS : 초당 몇개 블록(데이터 슬라이싱한 단위)을 처리(I/O)하는지

처리데이터 종류 등에 따라 디스크 선택해야 함(SSD, HDD, )

1GB당 3IOPS 제공 -> 필요한 IOPS에 따라 용량 선택하기도..

프로비저닝 : 미리 준비



고성능(미션 크리티컬)SSD필요할 경우 IOPS SSD

범용 SSD

EBS 와 인스턴스 통신 성능 보장하지 않음

성능(전송 속도 등) 필요할 때 공용네트워크 아닌 전용네트워크 따로 사용하는 '최적화 인스턴스' 사용하면 됨

여러 인스턴스가 공유하여 사용해야 할 경우 s3 혹은 EFS/FSx 써야 함 (ebs는 하나의 인스턴스에서만 사용 가능)

EFS/FSx 사용 : S3보다 빠름

인스턴스 타입명 : 패밀리이름(타입) + 숫자(세대) + '.' + 인스턴스 크기(large, xlarge 등)

-> 인스턴스 타입명만 보고 어떤 속성인지 확인 가능

t2와 t3타입  : cpu2개와 vpc 1개 제공base line정해두고 그거 넘어가지 못하도록 

크레딧 확보되면 그것을 소진해서 용량 많이 필요한 순간(버스팅할 때만)에 cpu 100사용하도록 함 

credit은 

dash보드의cost optimizer 통해서 비용 효율적인 자원 사용해야 함

초기도입 때에는 credit 베이스로 사용하고 credit사용패턴 확인해서 어떤 타입 사용할지 결정하면 됨

### EC2 요금 옵션

- 온디맨드 인스턴스 : 사용한만큼 과금(WINDOWS는 _초? LINUX는 _ 분?)

- 장기사용시에넌 예약인스턴스 사용(온디맨드보다 저렴)

- 스팟인스턴스 : 자주 사용하지 않는 스토리지 사용하도록 제공. 온디맨드의 10%수준 가격. 잉여스토리지 줄어들수록 요금 올라감, 보장안됨(쓰다 날라갈 수도 있음 ) 짧게 사용할 때에만.. -> 제거되기 전에 저장해주는 옵션 / 2분 정도 전에 이벤트로 사라질 것이라는 노티 주는 옵션 등 있음

  -> 스팟성 작업할 때(배치 작업 등)

- 

멀티 테넌시(클라우드에서 자주 쓰는 개념. 여러 사용자의 서비스가 하나의 컴퓨터에 올라가는 것) - 보안 강화 분야에선 불가 -> 보안측면에서 취약할 수 있어 전용서비스 사용

- 전용 인스턴스 : 호스팅 시작하는 순간 여유있는 호스트 골라서 사용 ->종료 시 그 호스트 점유 사라짐. 다시 시작하면 다른 호스트 찾음
- 전용 호스트 : 고정된 물리서버 점유(하나에서만 사용한다는 것을 눈으로 바로 확인 가능, 호스트 ID부여) 

### 인스턴스 사용량 추적

- 리소스 만들 때 태깅해서 태그 단위로 자원 묶어서 관리 가능 (EX - 웹서비스 용, 프로젝트A용 등) : 프로젝트 단위로 리소스 관리 가능하도록
- 리소스 그룹을 태그단위로 구성하게 됨

PV:반가상화 / HVM:전가상화 (EC2인스턴스 생성 시 선택)

### 컴퓨팅 계층 배치옵션 (클러스터배치 / 분산형 배치)

: 클러스터 배치(같은 랙에 할당 [-] 하나의 전원으로 관리되기 때문에 문제 발생 시 다 같이 문제되는 가용성 문제, 데이터 전송속도 빠름) / 분산형 배치그룹 (다른 랙에 할당. 안정성은 높음)

2개 이상의 리소스 만들 때 가장 짧은 지연 시간 및 높은 초당 패킷 네트워크 필요할 때 -> 클러스터 배치

안전성 중요한 소수의 크리티컬 인스턴스

네트워크인터페이스 설정은 네트워크 카드 설정하는 것임

키페어 설정은 계정 자동 로그인 설정하는 것(리눅스/윈도우 모두)

## 데이터베이스 계층 추가(관리형 DB)

DB는 EC2에서 올라옴 (EC2에 카산드라 오라클 등 사용할 유틸 설치)

- 고려사항 : 확장성, 총스토리지 요구사항, 객체 크기 및 유형, 내구성

[CF] 비관계형 DB : 키-값 형태 / 커넥션리스 형태(관계형의 경우 커넥션 베이스)

관계형의 경우 하나의 서버에서만 작동 가능하나 비관계형의 경우 서버 여러개 제한 없이 사용가능하여 확장성 크다

관리형 DB사용할 경우 사용자는 관리도 안해도 됨

관리형 DB서비스 : RDS, DynamoDB

- 관계형 : RDS, RedShift (redshift는 완전관리형이어서 따로 db엔진 설치도 안해도 됨. 데이터 웨어하우스 환경에서 보통 redshift 사용)
- Aurora : 완전관리형 amazon 관계형 db / mysql, postgres호환가능처리량의 최대 3배
- 비관계형 : DynamoDB / ElasticCache / Neptune
- 관리형은 사용자 별도 설정 다 필요 없이 그냥 테이블만 만들면 끝
- DynamoDB :
  -  이벤트 중심프로그래밍. 이벤트 발생 시 바로 노티 가능 (데이터 변경 시 알림. rds의 경우 문제 생기면 노티 되지만 데이터 변경 시 노티 기능 등은 없음)
  - 글로벌 테이블 제공  : 리전 간 데이터 복제 시 사용
- noSQL : 강력한 일관성 / 비강력 일관성 제공

최종일관성 / 강력한 일관성

- 강력한 일관성 : 복제 다 된 상태에서만 가져가게 함. 속도측면에서 느림
- 최종일관성 : 복제 전에 요청되면 업데이트 전의 자원 가져갈 가능성 있음. 속도 빠름

db엔진 교체 필요 시 : 마이그레이션 서비스 제공(Amazon Database Migratino Service)

Schema conversion tool(SCT)도 제공 : 데이터베이스 엔진 교체(ex-오라클에서 mysql로 이관 등) 시



## VPC

: AWS계정 전용 가상 네트워크, AWS 클라우드에서 다른 가상네트워크와 논리적으로 분리

: EC2인스턴스 등의 AWS리소스를 VPC에서 시작할 수 있음 (인스턴스 생성 후 VPC에 넣을 수도 있음)

: IP주소 범위를 설정하고 서브넷 생성 후 라우팅 테이블, 네트워크 게이트웨이 및 보안설정 구성하여 VPC구성

: L2레벨 네트워킹 제공 안됨 : 서버 위에 ''논리적인''네트워크 개념

: 통신의 개념보다는 격리의 개념이라고 생각하면 됨 (워크로드에서의 논리적 격리)

방화벽 라우터 테이블 등

하나의 VPC 내에 많은 리소스 인스턴스 있어도 경합 발생이 늘어나거나 하지 않음(부서별로 논리적으로만 분리해주면 됨. 물리적 문제는 밑단에서 다 처리가 된다고 함)

- 점유 리소스에 대한 특정 CIDR범위를 생성할 수 있음 
- CIDR(Classless Inter-Domain Routing) : CLASSLESS방식(IP에 서브넷 같이 설정되는 것?)
- 255.255.255.255/0, 32,24,16

- 리전 베이스(VPC는 하나의 리전에만 배포 가능)
- 계정(부서계정)단위로 VPC할당 (계정별 VPC, 계정당 다수 VPC )
- vpc만들 때 cidr 범위 크게 하는 것이 좋음(브로드케스트 신경쓸 필요 없고, 한번 설정하면 작게 자른 것 복구-IP부족한 경우 등- 불가하기 때문)
- 각 서브넷에서 5개 IP는 미리 할당되어 있어 사용 못함 - IP개수 계산할 때 고려 필요
- 하나의 VPC안에서는 서로 달느 서브넷 사이에도 통신 가능(라우팅 테이블 필요 없음)
- 다른 VPC에 전송할 때는 라우팅 테이블 정의해야 그것 거쳐 통신 가능
- 기본은 VPC전체용 라우팅테이블 관리 / 서브넷용 라우팅 테이블도 만들어 관리 가능(이것 통해 다른 VPC간 통신)

- [cf] 서브넷 : vpc에 속한 하위 범위 ip주소, aws리소스를 지정된 서브넷으로 시작하도록 설정 가능. 인터넷 연결이 필요한 리소스는 퍼블릭 서브넷을 사용, 인터넷 격리가 필요한 리소스에는 프라이빗 서브넷을 사용

- EC2생성 시 인터넷 연결하려면 퍼블릭 서브넷 사용하도록
- 인터넷 막으려면 프라이빗 서브넷에



- 퍼블릭세브넷에 NAT 게이트웨이(일종의 공유기?)설치해두고 프라이빗서브넷에서 그 퍼블릭 서브넷의 게이트웨이 사용하도록 설정하면 프라이빗서브넷 에서도 외부로 나갈 수 있음(여전히 들어오지는 못함)
- 프라이빗 서브넷에서는 공인IP없고 내부용IP만있기 때문에 이것으로 게이트웨이에 접속하면 게이트웨이가 공인IP로 변환해서 외부로 나가게 해줌

- 퍼블릭 서브넷은 인터넷 게이트웨이가 연결되어 있어야 함

### 인터넷 게이트웨이 : 완전관리형 서비스

인터넷 게이트웨이 : 수평적 확장으로 이중화를 지원하는 고가용성 VPC 구성요소, VPC인스턴스와 인터넷 간 통신 가능. 네트워크 트래픽에 가용성 위험이나 대역폭 제약이 발생하지 않음

- 게이트웨이 사용 목적
  - 라우팅 테이블에서 인터넷에 연결할 대상 제공
  - 퍼블릭 IPv5주소가 할당된 인스턴스에 네트워크 주소 변환(NAT)실행

라우팅테이블과 인터넷 게이트웨이 유무에 따라 외부 통신 가능 여부 결정됨

가용영역마다 퍼블릭, 프라이빗 각각 한개 씩

서브넷은 가용영역 내에만 존재 / VPC는 리전당 존재

인터넷 사용하려면 최소 1개의 PUBLIC VPC(공인IP)필요

퍼블릭, 프라이빗일 때 프라이빗을 더 많이 쓰도록 해줘야 함(퍼블릭 24 프라이빗 23  이렇게)

### ENI (탄력적 네트워크 인터페이스)

탄력적 IP(고정 공인IP)는 과금 있음

### 보안그룹 (체인형태로 설정 웹티어 / 엡 / DB 체인형태)

- EC2만들 때 보안그룹 생성 필요- > 설정 필요보안그룹마다 인바운드 룰 아웃바운드 룰 설정해줘야 함
- 상태저장 : 인바운드만 세팅하면 아웃바운드 룰은 자동생성됨
- 최초세팅은 인바운드는 아예 막히고 아웃바운드는 
- 포트넘버와 IP범위로 설정

### 서브넷 단위의 방화벽

https://bookshelf.vitalsource.com/#/books/100-ARCHIT-63-KO-SG-E/pageid/235

VPC 간 통신은 Peering 통해서 해야 함



보안그룹은 하나 이상의 인스턴스에 대한 트래픽을 제어하는 가상 방화벽 역할

인스턴스 시작 시 하나 이상의 보안그룹을 인스턴스와 연결

연결된 인스턴스와 트래픽 주고받을 수 있는 규칙을 각 보안그룹에 추가

보안그룹에 설정한 규칙은 자동으로 보안그룹과 연결된 모든 인스턴스에 적용

다중AZ배포옵션 선택하면 3두번째 AZ에 자동으로 DB 복제하여 가용성 높임





선택한 Virtual Private Cloud(VPC)에서 DB 인스턴스가 어떤 서브넷과 IP 범위를 사용할 수 있는지를 정의하는 DB 서브넷 그룹을 선택합니다. [자세히 알아보기](http://docs.aws.amazon.com/console/rds/db-subnet-groups)



IAM개념 알아보기iops알아보기

시스템매니저콘솔의 파라메터 스토어

[??]

vpc peering?

### 라우팅 테이블

- 라우팅 테이블 : 네트워크 트래픽이 향하는 방향을 결정할 때 사용하는 '경로'라는 규칙세트가 포함. vpc에 있는 각 서브넷은 라우팅 테이블에 연결되어 있어야 함. 테이블이 서브넷에 대한 라우팅을 제어
- 서브넷은 한번에 하나의 라우팅 테이블에만 연결 가능하나 여러 서브넷이 하나의 라우팅 테이블에 연결되는 것은 가능
- 인터넷 게이트웨이를 사용하려면 서브넷의 라우팅 테이블에 인터넷에 바인딩된 트래픽을 인터넷 게이트웨이로 향하도록 지시하는 경로가 포함되어야 함
- 인터넷 게이트웨이로 가는 경로가 있는 라우팅테이블에 서브넷이 연결되면 이 서브넷을 퍼블릭 서브넷이라 함
- 인터넷에 바운딩된 트라픽용 퍼블릭 테이블 생성
- 인터넷 게이트웨이로 인터넷에 바운딩된 트래픽 내보내는 라우팅테이블에 route추가
- 라우팅테이블에서 route가 로컬로 되어 있으면 설정된 ip대역으로의 모든 트래픽이 locally 라우팅 되어 vpc내 모든 서브넷이 서로 통신 가능
- 라우팅테이블 인스턴스 리스트의 MAIN 칼럼에 YES표시되어 있으면 전체 VPC용 라우팅테이블이고 NO일 경우 서브넷용 라우팅테이블임

####퍼블릭 서브넷 생성 방법

1. IGW 생성
2. 라우팅 테이블 생성
3. 0.0.0.0/0 트래픽을 인터넷 게이트웨이로 보내는 라우팅테이블에 경로 추가
4. 라우팅테이블을 서브넷과 연결



### 보안그룹

- 인스턴스에 대한 인/아웃바운드 트래픽 제어하는 가상방화벽 역할
- 보안그룹은 서브넷수준이 아닌 인스턴스 네트워크 인터페이스 수준에서 작동
- 각 인스턴스마다 트래픽 제어하는 자체 방화벽 있을 수 있음
- 시작 시 특정 그룹 지정하지 않으면 인스턴스가 자동으로 VPC의 기본 보안그룹에 할당됨

### VPC 피어링 연결

- 두 VPC사이에 비공개적으로 트래픽 라우팅할 수 있게 하는 두 VPC간의 네트워크 연결(같은 네트워크에 있는것처럼 양쪽 VPC인스턴스 간 통신 가능)
- 라우팅테이블 설정을 통해 피어링된 두 vpc 의 트래픽 전송 설정 가능
- 다른 계정이나 다른 리전에 속한 vpc 사이에도 피어링 연결을 통해 통신 가능 (다른 리전 간 피어링 시에는 인터넷 네트워크가 아닌 아마존의 백본네트워크 이용)
- 피어링 연결로 트래픽 전송하도록 라우팅 테이블 구성?
- 연결된 두 vpc 각자의 라우팅 테이블에 설정해야 피어링 연결을 통한 트래픽 전송 가능
- 라우트 설정 시 : 대상 ip주소가 연결대상 vpc범위에 속할 경우 피어링 연결 통해 트래픽 전송 가능
- 업무 특성 및 관리상 워크로드 분리 필요할 때 vpc피어링 
- ** 피어링 시 vpc 간 ip구간 중복되면 절대 안됨
- vpc 1:1연결만 지원(통해서 가는것도 안됨)

### VPN 엔드포인트 (인터넷 사용하지 않고 VPC외부에서 VPC에 연결되도록)

- 두개 타입 : 인터페이스 엔드포인트(연결 타겟 인스턴스에 대한 네트워크카드-ENR-를 VPC에 설치) / 게이트웨이 엔드포인트

### 실습3

- VPC CIDR 범위를 10.0.0.0/16 로 설정 (마지막 /N : N비트 프리픽스 지정 )

  -> 10.0.X.X로 시작하는 모든 IP주소 포함

  -> /16은 넷마스크

  10.0.0.0/24로 설정

  -> 10.0.0.X로 시작하는 IP주소 포함

  10.0.2.0/23

  -> 19.9.2.X, 10.0.3.X로 시작하는 모든 IP주소 포함

- IPv4 주소 범위를 CIDR(Classless Inter-Domain Routing) 블록으로 지정합니다(예: 
  10.0.0.0/16). /16보다 큰 IPv4 CIDR 블록은 지정할 수 없습니다. 또는 Amazon 제공 IPv6 CIDR 
  블록을 VPC에 연결할 수 있습니다.

- 인터넷 게이트웨이 생성하여 VPC연결했어도 퍼블릭 서브넷route table도 인터넷 게이트웨이 사용하도록 구성해야 함

  AMI 선택 : Amazon Linux 2 AMI (HVM), SSD Volume Type - ami-084040f99a74ce8c3

  Amazon  Linux 2는 5년간 지원을 제공합니다. Amazon EC2에 성능 최적화된 Linux kernel 4.14와 systemd  219, GCC 7.3, Glibc 2.26, Binutils 2.29.1, 최신 소프트웨어 패키지를 추가적으로 제공합니다.

  루트 디바이스 유형: ebs 가상화 유형: hvm

# DAY2

- 고가용성 
  - 장애 대비 된 안정성의 개념. 여러 AZ에서 서비스 실행하여 달성
  - [cf] AZ : 동일 리전 내 물리적으로 분리된 데이터센터(혹은 그룹)
  - 로드밸런서의 경우 본질적으로 고가용성 서비스
  - EC2 인스턴스(자체 고가용성x)를 여러 AZ에서 배포하여 고가용성 확보 가능

![](C:\Users\koooo\Desktop\architecture.png)

- [CF] NAT(Network Address Translation) 게이트웨이

  - NAT : 사설IP를 공인IP로 변환해주는 기술, 사설네트워크에 속한 여러개의 기기(호스트)가 하나의 공인IP를 사용하여 인터넷에 접속하기 위해 사용함
  - 가정에서 사용되는 공유기(==라우터)에 사용되는 기술
  - 퍼블릭 VPC 서브넷에서 *NAT 게이트웨이*를 사용하여 프라이빗 서브넷의 인스턴스에서 전송되는 아웃바운드 인터넷 트래픽을 활성화합니다.
  - 퍼블릭서브넷에 설치해야 함. EC2의 리눅스 환경에 NAT프로그램 설치하여 사용
  - EC2에 NAT프로그램 설치해서 사용하면 관리까지 해야 함. AWS NATGATEWAY서비스는 완전관리형임

- 네트워크 ACL(Access Control List)

  - 특정 패킷 차단하거나 허용할 때 사용하는 네트워크에서 방화벽 같은 역할
  - 트래픽을 필터링하고 IP주소와 서브넷을 정의

- 고가용성 : 로드밸런싱, 오토스케일링 개념

  Direct Connect : 인터넷 구간이 아닌 아마존에서 제공하는 전용선을 통하도록 함(성능 및 비용 절감 효과) - 전용선 문제 발생시를 대비해 vpn도 서브용으로 설정해둘 수 있음

- 여러 앱서버에서 앱이 실행되는 것을 고려하면 해당 서버 간 트래픽 분산 방법 필요

- 인스턴스 상태 확인하여 정상 인스턴스에만 요청 전송하는 로드밸런서를 사용하여 서버 간 트래픽 분산 기능 달성 가능

- 로드 밸런서에서 활성화할 가용 영역을 지정합니다. 로드 밸런서는 지정한 가용 영역에 위치한 대상으로만 트래픽을 라우팅합니다. 가용
  영역당 1개의 서브넷만 지정할 수 있습니다. 로드 밸런서의 가용성을 높이려면 2개 이상의 가용 영역에서 서브넷을 지정해야 
  합니다.

- 애플리케이션 로드밸런서는 모든 인스턴스에 대해 Health Check를 자동으로 수행하여 요청에 응답하는지 확인함

### Auto Scaling

- Amazon EC2 AutoScaling : 사용자가 정의한 정책 및 상태 확인에 따라 자동으로 EC2인스턴스를 시작하거나 종료하도록 설계된 웹서비스
- 여러 가용영역에 인스턴스 자동으로 분산하여 고가용성 앱 생성 가능
- 인터넷 연결 블락된 Private 서브넷에 존재하는 ec2인스턴스에 외부 요청이 전달되도록 하기 위해 : 사용자가 로드밸런서로 요청을 보내고 그 요청을 받은 로드밸런서가 해당 요청을 프라이빗 서브넷의 인스턴스에 전달하도록
- Auto Scaling을 사용하면 Amazon EC2 용량을 자동으로 관리하고 애플리케이션에 적합한 인스턴스 수를 유지할 수 있으며 정상 인스턴스 그룹을 운영하고 요건에 따라 규모를 조정할 수 있습니다.
- 오토스케일링 그룹의 인바운드 룰로 로드밸런서로부터의 http traffic 허용함- > 로드밸런서 통해서 외부의 트래픽 받고, 로드밸런서의 헬스체크 트래픽도 받을 수 있게 됨



- RDS설정에서 다중 AZ배포 선택할 경우-> 모든 요청을 처리하는 하나의 마스터 인스턴스 이외어 보조(SECONDARY)인스턴스가 시작됨. 마스터 장애 발생 시 이것이 동작. 앱은 기종 마스터 인스턴스의 DNS를 그대로 사용하나 연결은 현재 정상인 세컨다리로 리다이렉션됨
- [CF] IOPS : Input/Output Per Second : 초당 입출력 : 디스크 속도 단위

- 한개만 놓고 운용하는 인증서버 혹은 NAT서버의 경우 AUTO SCALIING 옵션에서 최소 1개로 설정해두면 그 단 한개가 에러발생하여 중단되면 하나가 생성됨


  ### Transit Gateway

  - 1:1 연결의 불편함 개선
  - 일종의 허브. 
  - VPN도 연결 가능
  - TG에 연결된 모든 VPC, VPN간 통신 가능하도록 한 것
  - 리전 간 연결은 안됨

  S3는 인터넷 사용하기 때문에 S3와 연결하기 위해서는 무조건 인터넷 타야 함(->보안이슈 발생 가능 / 성능 문제)

  VPC와 S3가 인터넷 연결 없이 다이렉트 연결하도록 하려면 End-point 사용하면 됨

## AWS 기반 로드밸런싱(ELB : 완전관리형 로드밸런서)

- L7로드밸런서 : APP계층(도메인네임 통해서) - ALB
- L4로드밸런서 : IP통해서 - NLB
- 웹서버는 내부에 두고 로드밸런서를 외부에 둬서 앱서버 보안 향상 
- TLS종료 : HTTPS 사용시 복호화작업(이를 TERMINATION이라고 함). 앞단에 ELB를 두면 로드밸런서가 터미네이션 작업을 헤주는 것
- 사용자와 ELB가 HTTPS연결되는 것이고 ELB와 서버는 HTTP연결. 서버에서 복호화에 사용하는 CPU 사용량 줄일 수 있음
- HTTPS연결 : 통신 시 인증서가 양쪽에 주어짐. 보내는 쪽에서 보내는 메세지를 인증서로 암호화하고 받는 곳에서도 받은 메세지를 인증서로 복호화함
- ELB는 내부적으로 확장 가능 - 복호화에 따른 CPU사용량 문제를 해결함. 집중이 예견되면 미리 TAM에 연락하여 준비 요청해야
- Connection draining활성화 : 한대의 서버가 종료해야 하는데 사용자 연결 있을 경우 연결 해제될 때 제거할 수 있도록 알려주는 것



가용성 확보를 위해서는 싱글포인트 패턴 제거해야 함(하나 죽으면 기능 불가한), 스탠바이 서버 준비(-> 비용문제 발생)

리전기반의 인스턴스는 소속 가용영역 문제 생겨도 다른 가용영역으로 대체 가능

ec2같은 가용영역 기반 리소스는 분산설계(이중화) 필요



## Route53(DNS서비스)

- 000개 엣지로케이션에 올라가서 안정성 보장됨
- 경로우회 기능 제공. 53은 DNS 포트넘버
- GLOBAL aCCELERATOR : IP주소를 통해 라우팅 분산해주는 서비스(작년 REINVENT에 발표)
- 단순 DNS서비스 아니라 경로우회기능도 제공하기 때문에 고가용성 확보에 좋음



## IAM(사용자 인증)

- 사용자 인증(누구인지)과 이에 따른 권한 관리
- 글로벌서비스
- ROOT계정은 모든 권한 있음
- 프로그래밍 코드 내에서 권한 사용하려면 인증키를 통해 권한 인증(콘솔 접근시에는 메일주소와 PW를 통해)
- 키를 코드에 박으면 안됨 - 깃헙 통해서 코드 공유 시 유출
- 원칙적으로 ROOT계정 작업 하지 말것, ROOT계정은 금고에 넣기(MFA토큰-인증용하드웨어 토큰-통해 관리할것)

### IAM 역할부여 주체 

자격증명 공급자

iam역할

연동 사용자

iam사용자



### IAM 사용자

- IAM사용자는 별도 AWS계정이 아니라 **계정 내**의 사용자
- 자격증명 부여받는 주체
- 인증 통과하면 권한 부여 받음
- 콘솔 , CLI 접근 권한은 디폴트는 없고 명시적으로 부여헤애 함

### 권한부여 방법

- 정책(행위와 제한에 대해)을 만들어서 권한 설정. 정책은 json타입
- 권한평가 절차 (거부 우선)
  - 명시적 거부 확인 -> 명시적 허용 확인 -> 거부처리
- 정책은 리소스 기반 / 자격증명 기반
  - 자격증명 기반 : 연결된 iam보안주체에 대해 권한 부여
  - 리소스 기반 : 서비스 자체에 권한 설정(S3등)

### 사용자 그룹

- 여러 사용자 관리 시 그룹 단위 관리 가능(사용자는 꼭 사람이 아니고 프로그램일수도.)

### Root user

- IAM관리사용자 생성해서 관리자가 사용
- 개발자/테스트/웹 형태로 유저를 세분화하여 액세스 권한도 세분화하여 관리



### IAM역할(ROLE)

: 임시 권한 부여하는 역할?(사용자 아님), 작업반장모자, 주로 서비스에 부여

- 사용자 뿐 아니라 인스턴스에도 부여 가능 - 인스턴스 내의 애플리케이션에 권한 부여하는것(이 프로그램이 S3에 접근할 수 있도록 등등)
- 키를 코드에 넣어서 인증하여 사용하도록 할 수 있지만, 인스턴스에 역할 부여하고 그 역할에 권한부여하면 그 인스턴스 내부의 프로그램이 키 없이도 해당 권한 필요한 작업을 할 수 있는것 ex- 이씨투 인스턴스가 다이나모 디비에 데이터 넣고 뺼 수 있도록 
- 

### 사용자 연동



한명의 사용자가 여러 계정에 접근해야 할 경우

-> 각 계정 모두에 해당 사용자를 등록해야 함(ID)

-> ROOT계정에서 사용자가 인증받으면 ROLE이용하여 각 계정에 권한 차별 부여

-> ROLE에 권한 설정해두고 ROLE과 ROOT계정 간의 신뢰관계만 확보해두면 각 계정마다 인증받지 않아도 됨

user생성 시 policy 선택할 수 있음 -> 이를 통해 권한(콘솔 접근 권한, 프로그램 접근 권한 등) 부여됨

secret key는 user name / secret key는 pw에 해당

계정에 role만들어두고 다른 게정에서 해당 role로 switch하면 그 롤의 계정 권한 갖게 됨

롤을 만들 때 롤에 권한을 부여해두고, 어떤 계정의 사용자가 그 롤에 접근할건지 설정해야 함 -> 해당 사용자가 그 role로 들어올 수 있음

역할은 위임하는 것

### security token

- bit.ly/Devlab - role을 이용한 임시키사용 해보기
- STS : 임시 키 부여하는 것과 연관된 것. 찾아보기
- 키를 코드에 박아넣지 않고 AMAZON에서 제공하는 SDK 임포트해서 API사용하면 임시 키 변동되는 것 그냥 받아서 쓸 수 있도록 되어 있음



## Amazon Cognitive (인증 서비스)

- IAM은 다수 사용자에 대한 처리를 한꺼번에는 못함
- 사용자 풀(계정생성), 자격증명 풀(다른 인증과 연결) 사용
- 다른 권한인증서비스와 연동하여 거기서 인증되면 자동으로 인증처리하도록
- 서비스 접근 시 인증에 대한 부분STS기반

- SAML : 아마존 인증서버와 사내 인증서버 간 연결
  - SAML어설션(일종의 URL)을 통해 리다이렉트

롤을 사용하면 임시키가 발급되어 보안적으로 안정적으로 사용 가능한 것



## AWS Organization

- 루트 계정 하위에 OU(서브계정그룹?)를 만들고 그 OU에 정책을 부여, 그 OU에 속한 AWS계정들은 그 계정의 루트 사용자도 그 정책에 한정되게 됨

정책기반과 역할기반의 차이점은 임시라는 점과 키 발급 차이인것인지?

역할은 정책과 달리 서비스에도 부여할 수 있음

역할 간 상속은 안됨 - 따로 만들어야 함

한명의 사용자는 하나의 역할만 가질 수 있음

역할은 기간 부여는 안됨

정책과 역할 중복되면 정책 우선으로 적용됨

임시 키 부여할 수 있다는 것이 역할의 장점?

AWS정책은 AWS서비스에 대한 액세스만 제어가능. OS단 권한관리가 필요할 경우 LDAP이나 SAML등을 이용





## 탄력성과 고가용성 및 모니터링

### 고가용성 -> 규모조정(<-auto scaling)을 통해 확보

- 내결함성(cold tolerant) : 앱구성요소의 내장된 중복성(문제 생겨도 이중화장비가 커버하도록)
- 복구성

### 탄력성 확보

- 시간기반
- 볼륨기반

### 탄력성 확보 기준을 모니터링을 통해 확보

- 모니터링 서비스 : Cloud Watch
  - Cost Explorer : 한달단위 보고서, 서비스별 사용량 확인 가능, 
    -  태그(프로젝트 단위, 부서 단위) 단위로 요금 보고서 뽑을 수 있음 - 태깅 중요
  - 리소스 지표 수집 및 추적 / 문제 발생 시 알람 발생
  - 지표 : 사용률 등 기본 지표, 사용자 정의지표 추가 가능
  - 로컬에 저장하는 로그들을 클라우드워치로 집중하ㅗ 가능
  - 로그를 알람 - http응답 404 떨어지면 알람 등 설정 가능
  - 규칙 설정 - 특정 시간마다 특정 프로그램 실행 등
  - 클라우드 워치를 통해 수집한 정보로 오토스케일링 
- 지정된 s3버킷에 로그 저장됨 - 로깅하도록 따로 설정 필요
- ec2애 에이전트 설치 필요 없이 모든 서비스 사항이 로깅됨

- VPC 인스턴스 선택하면 FLOW LOG 탭있음 거기서 활성화하면 CLOUD WATCH의 LOG에 저장됨
- CLOUD WATCH 의 LOGGING에는 비용이 부과됨
- EC2의 CPU 점유율 특정 수치 넘으면 스케일업 필요한 것
- 조건에 따라 새로운 인스턴스 추가하고 추가된 인스턴스를 로드밸런서에 추가하는 등의 자동화 가능
- 여러 가용영역에 걸치도록 설정도 가능

### 자동확장 방법

예약 / 동적 / 예측

EC2인스턴스는 개수의 SOFT LIMIT있음(리밋 늘린 후 최대치 설정하면 됨)

Launch configuration 을 통해 오토스케일링 동작 설정 / auto scaling group



RDS 오토 스케일링

- Readonly복제본을 구성-> select 날라올 때는 이 복제본에서 처리
- 개수로 늘어나는건 read only 밖에 안됨 노드를 수직적으로 늘리는 것(cpu 용량 늘리기)가동중단 시간 없이 수직적으로 확장 -> 이를 위해서는 다중구성 형태로 

단일 가용영역에만 rds만드는것을 단일구성이라고 함

RDS만들 때 다중 az옵션 선택하면 생성된 인스턴스가 STANBY 버전으로 다른 az에 생성됨(그냥 만든걸 MASTER 버전이라고 함)

마스터가 수직적으로 확장되면 스탠바이도 함께 늘어남

AURORA DB는 

서버리스 아키텍트 : 인프라 없이 (vpc, ec2, rds 같은거 고려 안함)-> 이런 인프라 설정 없이 그냥  : 대표적으로 s3

서버리스 장점은 인프라 디자인이 필요 없는것



- 샤딩 : 샤딩 sw통해서 db 파티션을 나누는 것

## AWS CloudFormation

- 자동화된 일정에서 자동으로 배포할 수 있는 템플릿으로 인프라 정의 및 변경
- 인프라를 계층화형태로 배포, 일부 리소스는 유지하면서 스택 업데이트 및 삭제 가능
- CloudFormation템플릿 기반으로 패키지(제품)제공하기 위해 서비스 카달로그 사용

- 권장사항은 layers에 인프라 배포하는 것. 일반적인 계층은 network/db/app

  -> dev/test/production 간 일반적인 네트워크 토폴로지 배포나 여러 앱에 표준 db배포하는 등의 시스템 간 템플릿 재사용 가능

  ex) VPC사용하여 네트워킹 레이어 생성하는 CloudFormation template 배포

- template파일(yaml, json포맷)작성하여 업로드하면 designer에서 구조도(그래픽 표현) 그려줌

- cloud formation을 통해서 대부분의 인프라 구성할 수 있음(콘솔 가서 클릭 안해도 됨?)
- 설계도를 json혹은 YAML포맷으로 만들면 이를 CLOUDFORMATION이 생성해줌(CLOUDFORMATION은 스크립트의 순차적 방식이 아님. 어떤 방식으로 하든 결과가 동일한 멱등성의 원리를 가지고 있음 - 어떤 절차를 통해서 되고 있는지 확인하는게 무의미 스택생성이 완료되었다는 것은 모든게 제대로 설정되었음을 믿으면 됨.  롤백이 되면 뭔가 한 단계에서라도 에러 있었다는 것 )
- 디자인템플릿 메뉴를 통해 JSON이나 YAML(야믈)아닌 그래피컬 구성도 가능ㄴ

- FORMATION만들어진 상태가 STACK.

- 스택단위로 관리.

- 템플릿 실행 시 다른 자원 참고해야 하기 때문에 권한 필요함. 이 권한 포메이션 구성 시 정해야 함(IAM)

- 템플릿 통한 CloudFormation사용 시 직접 콘솔가서 자원 속성 변경하지 말것을 권장. 변화가 감지되면 롤백시킬 위험 있기 때문

  ### IaC (Infrastructure as Code)

스택업데이트는 변경점 검사해서 변화한 부분만 업데이트하도록 하는 최소한의 변화방식

설계는 계층화된 아키텍처 : 백엔드용 VPC용 등 목적 별 템플릿을 생성해서 계층적으로 구성 - 수정도 쉽고 재사용도 쉽고



표준화된 템플릿을 AWS에서 제공 : Quick Start 서비스( 샘플 템플릿 있음. Best-practice제공)

AWS Former서비스 : 지금 생성되어 이용되고 있는 인프라를 템플릿으로 변환해줌(현재는 베타버전, AWS서비스에 대한 것만 가능. 다른 클라우드 서비스에대해서는 불가)

템플릿 하나로 여러개 클라우드 벤더 템플릿 만드는것이 오픈소스인 TERRAFORM이다!!오호오호그렇군!!!



### 배포 자동화

- 기본 인프라 갖춰진 상태에서의 배포 / 인프라 플랫폼부터 만든 후 배포

#### AWS System Manager

- AWS SySTEM mANAGER : 인프라 자동생성 및 장애 복구 등을 자동으로 해주는 서비스 / 구성 자동화(패치 업데이트, 쉘스크립트 수행 등을 통해)

- 명령 실행 유지관리시간 패치관리 상태관리자

  

### 세션매니저 기능 통하면 리눅스 ec2라도 인터넷 등등 타지 않고 ssh없이 접근 가능

- cloud nine과는 다름 ?? - 질의답이었음

- 세션매니저는 윈도우 아니고 리눅스만 가능

- 에이전트를 온프레미스 환경에 설치해두면 세션매니저 통해서 접근 가능

- 세션매니저 통하면 ssh없이(키페어 필요 없이) 바로 콘솔로 접근 가능 -> 커맨드 실행 가능

### aws opswork

- CHEF, puppet 서비스 같은거 쓰는것 권장

- APACHE 버전 업시킬 때 -> 각 서버에 접속해서 아파치 업데이트(운영체제상의 업데이트)

- CHEF, PUPPET이 스크립트 작성하면 모든 서버에 스크립트 실행되도록 자동화해주는 툴 -> 이를 위해서는 PUPPET자체가 다 설치되어 있어야 함

- 이런 기능 해주는게 OpsWorks : ec2에 opsworks설치해서



cloudformation : 인스턴스 생성하는 작업

opswork : 인스턴스 안에 프로그램 설치 및 제거 설정 변경등의 작업. 이것도 스택 형식으로

### Elastic  Beanstalk

- 사용자는 코드만 작성하고 그 하위에 웹서버 포함한 모든 웹인프라 만들어주는 서비스
- 



NACL: 룰넘버에 따라 우선순위 정해짐(숫자가 우선순위 가장 높고 *가 가장 낮음. )



로드밸런서 실습할 때 인터넷 페이싱으로 해서 외부 트래픽 수용함 설정하고 그 후 EC2두개만드는것 안보이게 내부적으로 사용할 목적으로 만드는것임

# Day3

## 캐싱

- Amazon CloudFront : CDN서비스(앞단에 캐시둬서 속도 향상시키는 것이라 생각하면 됨)
- 캐싱 : 
- 서버캐싱 : Reverse proxy 캐시, 웹서버 캐시 등 사용

- 엣지로케이션 : 리전 내에 존재하기도, 별도 영역에 존재하기도
- 엣지캐시 - cdn에 이용
- 서울리전에 버킷 있을 경우 원격지에서 데이터 가져갈 때 근처의 엣지 로케이션에 캐싱을 통해 카피해두면 속도 향상 가능
- 장점 : 속도, 비용(S3에서 end user한테 아웃바운드되는 트래픽은 비용발생하지만 cloudFront로의 트래픽은 비용 발생안함)
- 캐싱 단점(컨텐츠 업데이트 안됨) 극복방법
  - TTL(Time TO Live) : 캐시 기한 설정
  - cloud fromt에서 오리진으로의 GET요청에 If-Modified-Since 헤더 사용
  - 객체 이름 변경
  - 객체 무효화(비용발생)
- 캐싱 무의미한 동적컨텐츠의 경우에도 클라우드 프론트 앞단에 두면 디도스 공격 등 보안적 측면 향상시킬 수 있음. 성능향상도 있을 수 있음(사용자가 오리진에 직접 데이터 가져가는것보다 클라우드프론트 통하는게 더 빠른 경우도 있음)

- Shield옵션 있음 : DDOS공격 방어
- 고정세션 기능 제공 - 세션 유지되도록 하나의 호스트에만 가도록(?? 권장안함)
- 권장 : 세션정보를 외부 DB 등에 빼서 저장해두고 세션을 거기서 찾아서 찾아가도록
- DAX : DynamoDB전용 캐싱 서비스 포함된 DynamoDB : 고속 서비스 가능. 서울리전엔 없음

### Elastic Cache

- Redis와 Memcached의 완전관리형 버전 (DB용 캐시)
- Elastic cache사용할 경우 기존의 앱 코드 수정해야 함 - DB 서치 전에 캐시에서 서치하고 없을 경우 DB로 가도록
- 캐시는 키-밸루 형태로 확인하도록 코드 수정하면 됨
- DAX사용할 경우 코드 수정 필요 없고 코드상의 엔드포인트만 캐시서버로 바꾸면 됨

### 캐싱 방법

- 연속쓰기(쓸 때 캐시랑 오리진에 다 쓰기)
- 레이지로딩(오리진 확인 전 캐시 확인->없으면 오리진 확인->캐시에 쓰기)

## 아키텍처 결합 해제

CF)3TIER구조 : 웹-앱-DB 

- 밀결합 : 3 티어 중 한 티어의 한 부분에 문제 생기면 그와 결합된 모든 서비스에 장애 발생하게 되는 구조
- 밀결합을 소결합화 해야 함 
- 소결합(결합해제) 방법
  - 로드발란서 이용 : 앱과 앱이 직접 연결 되지 않고 로드밸런서 통해서 연결. 장애 일어나도 로드밸런서가 정상 인스턴스로 리다이렉트 해서 다른 티어로의 장애 방지
  - Amazon SQS서비스
    - Queue서비스(아파치 MQ, 등등 많이 사용됨)의 완전관리형 AWS서비스
      - queue : 비동기 처리
      - 프로세스 간 비동기 연결
      - 단일 엔드포인트 요청을 분산시킴

폴링방식 ; 프로그램이 변화 있는지 s3에 계속 확인하는것(서치 비용 발생)

대신 이벤트 방식(s3에서 데이터 올라오면 프로그램에 이벤트 보내는 방식)

이벤트 많이 쌓이는 문제 : 이벤트를 큐에 쌓기. 프로그램은 큐를 폴링해서 이벤트 가져다가 처리 ; 비동기 처리

오토스케일링과 큐를 연계->큐에 많이 쌓이면 오토스케일링 통해 ec2늘려서 처리하도록

큐사용의 장점 : 비동기식 처리 가능 / 작업 인스턴스 수 늘려 성능 및 서비스 요구사항 처리 / 처리 문제발생 시



대기열 유형

: 표준(STACK) / FIFO

### SQS지원기능(작업 비동기 처리 위해 사용)

- 배달하지 못한 편지함(수신자가 가져갔지만 큐에서 지워지지 못한 것들 보관한 큐) - Redrive policy에 설정한 횟수만큼 가져간 데이터 지우는 시도 한 후 안되면 그 큐로 이동 : 이 큐에 데이터 있는지 확인. 여기 데이터 쌓여 있으면 배달 문제 있었음을 확인하는것

- 가시성 제한 시간 : 메세지는 한명의 사용자만 볼 수 있음. 내가 가져가고 나서 이 시간 내에 메세지 지우지 못하면 실패. 동시에 다수 사용자가 볼 수 없게 하는 LOCKING 기법
- 긴 폴링 : 폴링(데이터 있는지 조회하는 것)이 짧으면 데이터 있는 데도 못 가져가는 케이스 생김. 짧은 폴링은 빠른 조회 목적. 긴폴링은 데이터 확실하게 가져가기 위한 알고리즘. 데이터가 하나의 서버에 통째로 들어가는 것이 아니고 분할되어서 여러 서버에 있기 때문에 폴링이 짧으면 다수 서버 다 조회해서 완전히 가져가기 힘듦. 긴폴링 시간 내내 있는것이 아니라 그 시간 내에 데이터 들어오면 가져가는것

: 앞단과 뒷단의 루즈한 비동기 연결 지원

버퍼로 사용

## AWS SNS서비스

: 메세지 푸쉬 서비스

ELB를 통한 밀결합 해제

SNS SQS 를 통해 메세지 전달하는 것



## MicroService architect

- 람다, 도커와 연관
- 마이크로서비스 : 앱이 잘 구성된 API를 통해 통신하는 독립서비스로 구성된 형태

- 앱이 서비스로 잘게 쪼개지면서 서버 간 통신이 매우 중요해짐
- ipc, 소켓통신, api형식
- api통신은 각 서버의 구성 언어 달라도 api를 통해 통신 가능
- 하드웨어 가상화 == 하이퍼바이저 서비스

컨테이너 : os가상화

DOCKER는 하나의 OS를 마치 여러개 있는 것처럼 쪼개서 사용하는 기술

-> OS따로 설치하지 않아도 되기 때문에 편리

별도의 OS부팅시간 필요 없어지는 효과

OS에 후크 포함 : 컨테이너(일종의 이미지)에 약간의 OS정보도 들어간다는 것.



하드웨어 가상화(AMI) : 가상화된 하드웨어까지 포함하는 이미지

도커는 어플리케이션만 이미지로 만드는 것

교재에서 바이너리/라이브러리라고 표현된게 이 OS관견 정보인것

도커는 엔진.

도커 구성하기 위해서는 인프라 필요

서버 여러대를 묶어 클러스터로 관리

도커는 한번 세팅만 되면 쉬움

### ECS

근데 그것을 세팅하기 위해 서버 클러스터 만들고 하는것들이 번거로움 -> AWS ECS가 관리형으로 제공하는 도커 툴

보통 도커는 ___

도커 배포를 위해ECR사용하는것(이미지를 따로 모아 보관하는 공간)

ECS가 이 이미지를 플레이할 EC2인스턴스 찾아서 플레이시켜주는 것

쿠버네티스도 ECS처럼 관리해주는 서비스

EKS는 쿠버네티스 관리 서비스



AWS Fargate : 클러스터 구성 하는 역할



### Lambda

- 완전관리형 컴퓨팅 서비스. ec
- 상태 비저장 코드 실행서비스
- 코드 실행된다!
- function만들면 됨
- trigger란에 인스턴스 종류(s3, api gateway 등) 올리고 설정하면 해당 인스턴스에 이벤트 발생하면 람다 실행되도록 하는것
- 람다는 이런 이벤트 혹은 시간 대 등등 조건 걸어 자동 실행 설정 가능
- 람다는 호출 횟수 당 + 메모리크기*사용시간 과금
- 메모리 크기 동적으로 할당 가능..? 이거 찾아보기 뭔 소리?
- 호출횟수100만건까지는 무료
- **실행시간 15분 한정**
- 병렬처리도 가능
- 실패해도 따로 노티를 주지는 않음
- 어떤 스펙의 cpu에서 실행되는지는 동일함, 메모리 크기 크게 설정할수록 속도 빨라진다고 보면 됨
- 

### API Gateway

: 람다와 동시에 많이 사용

- 엔드포인트 노출 방지
- SQL Injection 방지
- 인증 추가해서 인증받아야 호출되도록 설정도 가능(cognito등과 연계)
- 호출 횟수 제한도 가능(삼성에서 오는 api하는 하루 100건만 등)
- api gateway는 엣지 로케이션, 리전, vpc, 클라우드 프론트 등에 설치 가능
- 

resfful API는 URI호출시 API 호출

동적 컨텐츠는 api게이트웨이 통해 람다 호출, 람다가 aws 서비스 호출하느 ㄴ구조로 : 서버리스 아키텍처

- 블루프린트 : 람다 함수 작성을 위한 템플릿. 알렉사 기술생성 및 아마존 키네시스 ~스트림 처리같은 표준 람다 트리거의 경우에 제공됨

### AWS Step function

: amazon상태언어로 람다를 순차적으로 수행하도록

: 람다 이어서 수행하도록 하는 것(하나의 람다 당 15분 개수 제한도 없음)



넷플릭스의 카오스멍키 : 장애 대비를 위한 프로그램

## 장애 대응

- RPO, RTO : 장애 대응 수치
  - RPO(Recovery Point Objective) : 장애 발생 후 복구 시점 : 1시간으로 설정할 경우 장애 발생 1시간 전으로 복구 (얼마나 자주 데이터 백업하나)
  - RTO(Recovery Time Objective) : 장애 복구에 걸리는 시간

- 온프레미스를 aws로 백업하려면 starageGateway사용하면 됨

- 파일럿라이트 : 온프레미스에서 장애 발생 시 이를 모니터링 하여 aws에서 해당 서버를 
- 이미지로 동일하게 만든 후 aws로 서비스하는 것 : 복구에 시간 많이 걸린다는 단점 있음

### 장애대응전략(4종)

- route53이 온프레미스 장애 발생 시 aws쪽으로 리다이렉션하도록 설정해둠
- 온프레미스 db를 보조 awsdb로 카피
- 서버 평소에는 꺼져있으니까 비용도 저렴(저용량 스탠바이 설정하면 좋음)
- 다중사이트 액티브-액티브 : 최대용량으로 구성하는 것



서브넷은 반드시 **다른 가용영역에 이중화**해서 설정해야!!



다이나모스트림에 의해 트리거



첫번째

이벤트 트리거한 파일을 s3에서 다운로드

파일의 각줄을 루프처리

데이터를  dynamodb inventory테이르에 삽입

두번째

수신코드를 루핑

재고 수량 0일 경우 nostock sns주제에 메세지 전송